#!/bin/sh

# nvim
mkdir -p ~/.config/nvim/bundle
mkdir -p ~/.config/nvim/vundle_plugins
mkdir -p ~/.config/nvim/swaps
mkdir -p ~/.config/nvim/backups

if ! [ -d ~/.config/nvim/bundle/Vundle.vim ]; then
  git clone https://github.com/VundleVim/Vundle.vim ~/.config/nvim/bundle/Vundle.vim
fi

cp modules/essentials/nvim.rc ~/.config/nvim/init.vim
nvim +PluginInstall +qall

# tmux
cp modules/essentials/tmux.conf ~/.tmux.conf

# git
cp modules/essentials/gitconfig ~/.gitconfig
cp modules/essentials/gitignore ~/.gitignore
git config --global core.excludesfile ~/.gitignore

# zsh
ZSH_SCRIPTS=~/.zsh-scripts
mkdir -p ~/.oh-my-zsh-plugins
mkdir -p $ZSH_SCRIPTS

ZSH_SCRIPT_LOADING=$(cat <<SH
for script in $ZSH_SCRIPTS/*.zsh; do
  source \$script
done
SH
)

ZSH=~/.oh-my-zsh
if ! [ -d $ZSH ]; then
  # short version of the omz setup, but skips switching to zsh at the end
  # so that the other stuff can continue
  git clone --depth=1 https://github.com/robbyrussell/oh-my-zsh.git $ZSH

  if [ -f ~/.zshrc ] || [ -h ~/.zshrc ]; then
    mv ~/.zshrc ~/.zshrc.pre-oh-my-zsh;
  fi

  cp "$ZSH"/templates/zshrc.zsh-template ~/.zshrc
  sed -i "/^export ZSH=/ c\\
  export ZSH=\"$ZSH\"
  " ~/.zshrc

  sed -i 's/^plugins.*$/plugins=(`ls ~\/.oh-my-zsh-plugins`)/' ~/.zshrc

  echo "$ZSH_SCRIPT_LOADING" >> ~/.zshrc

  chsh -s $(grep /zsh$ /etc/shells | tail -1)
fi

# ctags
cp modules/essentials/ctags ~/.ctags

# ag
cp modules/essentials/ignore ~/.ignore

# ag / git
cp modules/essentials/essentials.zsh $ZSH_SCRIPTS/essentials.zsh

# ssh
mkdir -p ~/.ssh
cp modules/essentials/ssh-config ~/.ssh/config
chmod 0700 ~/.ssh

